# Университетское приложение

Это монорепозиторий учебного проекта, состоящий из бэкенда на FastAPI и
фронтенда на React + Vite. Приложение моделирует мобильный сервис
поддержки студентов: расписание, мероприятия, лидерборд, курсы,
профиль и магазин.

## Запуск

### Предварительные требования

- Python 3.11+
- Node.js 14+ (для сборки фронтенда). Для визуализации
  дорожной карты курсов используется библиотека [`@xyflow/react`](https://www.npmjs.com/package/@xyflow/react),
  которая устанавливается при запуске `npm install`.
- PostgreSQL (по умолчанию контейнер запускает сервис `db` из
  `docker‑compose.yml`)

### Бэкенд

1. Установите зависимости:

   ```bash
   pip install -r backend/requirements.txt
   ```

2. Запустите приложение:

   ```bash
   uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
   ```

   При старте база данных инициализируется, создаётся демо‑пользователь
   с `id=1` и ролью `teacher`. Кроме того, существующие расписание и
   мероприятия очищаются и заново заполняются примерами на всю текущую
   неделю. Все запросы к API по умолчанию выполняются от имени этого
   пользователя.

### Фронтенд

1. Перейдите в директорию `frontend` и установите зависимости. Помимо
   стандартных пакетов будет установлен `@xyflow/react`,
   необходимый для отображения графа курсов:

   ```bash
   cd frontend
   npm install
   ```

2. Запустите dev‑сервер:

   ```bash
   npm run dev
   ```

3. Приложение будет доступно по адресу `http://localhost:5173`.

### Docker

Для удобства можно воспользоваться docker‑compose:

```bash
docker-compose up --build
```

Это соберёт и запустит бэкенд, фронтенд и базу данных в отдельных
контейнерах. Фронтенд автоматически проксирует запросы `/api/*` на
бэкенд.

## Основные возможности

* **Расписание:** отображает учебные занятия и события в виде
  календарной сетки. Вкладка «My events» показывает занятия, на которые
  вы записались, и внеучебные мероприятия, на которые подписаны или
  которые вы создали. Создание нового мероприятия вынесено в
  переиспользуемый компонент `CreateEventForm`.
- **Мероприятия:** список внеучебных событий с возможностью
  подписаться/отписаться. При подписке событие появляется в личном
  расписании.
- **Лидерборд:** рейтинг университетов по количеству очков.
* **Курсы:** интерактивная дорожная карта обучения с графическим
  представлением дорожек. Для визуализации графа используется
  библиотека [`@xyflow/react`](https://www.npmjs.com/package/@xyflow/react),
  которая позволяет позиционировать узлы и рисовать связи без
  дополнительных UI‑компонентов. Каждое занятие отображается
  панелью с названием, кратким описанием и наградами. Завершая
  курсы, вы получаете опыт и монеты.
- **Профиль:** отображает имя пользователя, роль, прогресс, опыт,
  монеты и список завершённых курсов/покупок.
- **Магазин:** (заготовка) позволяет расходовать монеты на покупки.

## API

Бэкенд предоставляет следующие основные эндпоинты (префикс `/api` на
фронтенде добавляется прокси‑сервером):

| Метод | Путь | Описание |
|------|------|----------|
| `GET` | `/schedule` | Вернуть расписание. При указании `user_id` в
  query‑параметре каждое занятие содержит флаг `signed_up`. |
| `POST` | `/schedule/{id}/signup` | Записаться на занятие. |
| `GET` | `/events` | Список событий. При указании `user_id` содержит
  `signed_up` и `signup_count`. |
| `POST` | `/events` | Создать новое событие. |
| `POST` | `/events/{id}/signup` | Подписаться на событие. |
| `POST` | `/events/{id}/unsubscribe` | Отписаться от события. |
| `GET` | `/leaderboard` | Список университетов в порядке убывания очков. |
| `GET` | `/profile` | Профиль пользователя по умолчанию (ID=1). |
| `PUT` | `/profile/{id}` | Обновить данные пользователя. |

Полный список схем смотрите в файле `backend/app/schemas.py`.

## Прогноз нагрузки и стоимости

### Нагрузка

Сервис рассчитан на небольшое количество одновременных пользователей
(учебный проект). Запросы к бэкенду занимают доли секунды и не
используют сложные вычисления. Основной объём данных — списки
расписания и мероприятий — ограничен десятками записей. При росте
количества пользователей сервер можно горизонтально масштабировать
через Gunicorn/Uvicorn workers, а PostgreSQL вынести в управляемый
кластер.

### Стоимость

Минимальная конфигурация для продакшена может состоять из:

- ВМ с 2 vCPU и 2 GB RAM для бэкенда (~10–15 USD/мес в AWS/GCP);
- ВМ с 1 vCPU и 1 GB RAM для фронтенда или хостинг на static site
  hosting (например, Vercel);
- управляемая PostgreSQL (~15 USD/мес).  

Итого ориентировочная стоимость: 30–40 USD в месяц. Для учебных
целей всё можно развернуть на одной машине.
